/** @license art-ajax v2.2.1 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("art-util")):"function"==typeof define&&define.amd?define(["art-util"],e):t.ArtAjax=e(t.ArtUtil)}(this,function(h){"use strict";var i,t,e={method:"GET",timeout:5e3,responseType:"json",withCredentials:!1,maxContentLength:-1},g="application/x-www-form-urlencoded;charset=utf-8",u=new(function(){function t(){this.globalOptions={}}return Object.defineProperty(t.prototype,"headers",{get:function(){return this.headerObj},set:function(t){this.headerObj=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"timeout",{get:function(){return this.globalOptions.timeout},set:function(t){this.globalOptions.timeout=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"responseType",{get:function(){return this.globalOptions.responseType},set:function(t){this.globalOptions.responseType=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withCredentials",{get:function(){return this.globalOptions.withCredentials},set:function(t){this.globalOptions.withCredentials=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxContentLength",{get:function(){return this.globalOptions.maxContentLength},set:function(t){this.globalOptions.maxContentLength=t},enumerable:!0,configurable:!0}),t.prototype.getHeadersData=function(){var t=this.headerObj;if(t){var e={};for(var n in t)h.type.isFunction(t[n])?e[n]=t[n]():e[n]=t[n];return e}return null},t.prototype.getBaseOptions=function(){var t=this.getHeadersData();return t?Object.assign(this.globalOptions,{headers:t}):this.globalOptions},Object.defineProperty(t.prototype,"ajaxComplete",{get:function(){return this.ajaxCompleteObj},set:function(t){this.ajaxCompleteObj=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ajaxStart",{get:function(){return this.ajaxStartFun},set:function(t){this.ajaxStartFun=t},enumerable:!0,configurable:!0}),t}());function m(t,e){return void 0===e&&(e={}),Object.assign({status:t?t.status:0,statusText:t?t.statusText:"unknow",returnCode:-999,returnMessage:"unknow"},e)}function p(p,d,l){var t=u.getBaseOptions();(l=h.util.mixin({},e,t,l)).method=(l.method||"GET").toUpperCase();var c=new XMLHttpRequest,f={data:null,statusCode:null,statusText:null};return l.withCredentials&&(c.withCredentials=!0),new Promise(function(t,n){c.open(l.method||"",p,!0),c.onerror=function(t){c.onreadystatechange=null,console.error("请求异常：",t),n(m(c))},c.onreadystatechange=function(){if(4===c.readyState){if(f._timeoutHandler&&clearTimeout(f._timeoutHandler),c.status<200||400<=c.status)return void n(m(c));if("xml"===l.responseType)f.data=c.responseXML;else{var e="response"in c?c.response:c.responseText;if("json"===l.responseType)try{f.data=JSON.parse(e)}catch(t){console.error("result is not json "+e),f.data=e}else f.data=e}f.statusCode=c.status,f.statusText=c.statusText,t(f)}},h.type.isNumber(l.timeout)&&l.timeout!==1/0&&(c.timeout=l.timeout||0,f._timeoutHandler=setTimeout(function(){c.onreadystatechange=null,c.abort(),n(m(c,{status:0,statusText:"time out!"}))},l.timeout));var e=!1;if(l.headers)for(var o in l.headers)"Content-Type"===o&&(e=!0,h.type.isFormData(d)&&n(m(c,{status:0,statusText:"FormData数据类型不能设定Content-Type"}))),c.setRequestHeader(o,l.headers[o]);var r,a,s=(r=d,a={sendData:""},h.type.isFormData(r)?a.sendData=r:h.type.isURLSearchParams(r)?(a.contentType="application/x-www-form-urlencoded;charset=utf-8",a.sendData=r.toString()):h.type.isObject(r)?(a.contentType="application/json;charset=utf-8",a.sendData=JSON.stringify(r)):(a.contentType=g,a.sendData=r),a),i=s.sendData,u=s.contentType;!e&&u&&c.setRequestHeader("Content-Type",u),"function"==typeof l.onDownloadProgress&&c.addEventListener("progress",l.onDownloadProgress),"function"==typeof l.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",l.onUploadProgress),c.setRequestHeader("_log4xContextKey",h.uuid()),i?c.send(i):c.send()})}function s(t,e,n){var o=p(t,e,n).then(function(t){var e=t.data;if(h.type.isObject(e)){if(e.returnCode===i.success||"0"===e.returnCode)return{data:e,res:t};throw m(void 0,{status:t.statusCode,statusText:t.statusText,returnCode:e.returnCode,returnMessage:e.returnMessage||"request error!"})}return console.warn("response "+e+" is not Object"),{data:e,res:t}},function(t){throw console.error("request error!",t),t});if(u.ajaxComplete){var r=u.ajaxComplete,a=r.success,s=r.error;return o.then(a,function(t){throw s(t)})}return o}return(t=i||(i={}))[t.success=0]="success",t[t.fail=-9999]="fail",{put:function(t,e,n){if(void 0===n&&(n={}),n.method="PUT",u.ajaxStart){var o=u.ajaxStart(t,e,n);o.url&&(t=o.url),o.data&&(e=o.data),o.options&&(n=o.options)}return s(t,e||"",n)},get:function(t,e,n){if(void 0===n&&(n={}),n.method="GET",u.ajaxStart){var o=u.ajaxStart(t,e,n);o.url&&(t=o.url),o.data&&(e=o.data),o.options&&(n=o.options)}return s(h.url.mixinUrl(t,e),"",n)},post:function(t,e,n){if(void 0===n&&(n={}),n.method="POST",u.ajaxStart){var o=u.ajaxStart(t,e,n);o.url&&(t=o.url),o.data&&(e=o.data),o.options&&(n=o.options)}return s(t,e||"",n)},del:function(t,e,n){if(void 0===n&&(n={}),n.method="DELETE",u.ajaxStart){var o=u.ajaxStart(t,e,n);o.url&&(t=o.url),o.data&&(e=o.data),o.options&&(n=o.options)}return s(t,e||"",n)},combine:function(t,e,n){void 0===e&&(e={}),void 0===n&&(n={}),n.method="POST";for(var o=[],r=0;r<e.length;r++){var a={url:"",data:{},options:{}};-1<e[r][0].indexOf("http:")||-1<e[r][0].indexOf("https:")?a.url=e[r][0]:a.url=window.location.origin+e[r][0],a.data=e[r][1]?e[r][1]:{},a.options=e[r][2]?e[r][2]:{},o.push(a)}return s(t,o,n)},globalConfig:u}});